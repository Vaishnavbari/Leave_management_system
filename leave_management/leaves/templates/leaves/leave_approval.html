
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Leave Management System</title>
    <!-- MDB icon -->
    <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon" />
   
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" />
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" />
    <!-- MDB -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        
        table {
            border: solid black 1px;
        }

        table, th, td, thead, tbody, tr {
            background-color: transparent !important;
            color: black !important;
            border:2px solid black;
          
        }
        .centered {
            vertical-align: middle !important; /* Center text vertically */
            text-align: center !important;;
          }

        .main{
          background-size:cover;
        }

        .editable {
            border: 2px solid black; 
            padding: 5px;
        }
        .table-fit {
            width: 100%;
            table-layout: fixed;
        }
    
        .table-fit th, .table-fit td {
            word-wrap: break-word;
        }
        .table-responsive-leave {
            display: table;
        }

    </style>
</head>

<body class="main">
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
   <center> <h3 class="m-3"> Leave Approval Data  </h3></center> 
    <div class="table-responsive-leave" style="margin:2rem">
        <table class="table table-sm table-fit " style="color:black; background-color: white !important;  text-align: center !important;">
            <thead style="background:none; color:black">
                <tr style="background:none color:black">
                    <th scope="col">id</th>
                    <th scope="col">Date From</th>
                    <th scope="col">Date To</th>
                    <th scope="col">reason</th>
                    <th scope="col">status</th>
                    <th scope="col">HR status</th>
                    <th scope="col">PM status</th>
                    <th scope="col">TL status</th>
                </tr>
            </thead>
            <tbody id="genrater">
                {% include "leaves/leave_approval_table.html" %}
            </tbody>
        </table>
    </div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
    $(document).ready(function () {
        $(".select").change(function () {
            var status = $(this).val();
            console.log(status)
            var id = $(this).attr("id");
            $.ajax({
            url: `http://127.0.0.1:8000/leave/approve/${id}`,
            type: "PUT",
            data: JSON.stringify({status: status}),
            contentType: "application/json",
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            success: function (response) {
                loadTableData ()
             if(response.status = 200){
                Toastify({
                    text: response.message,
                    duration: 3000,
                           gravity: "top",
                           position: "right",
                           stopOnFocus: true,
                           style: {
                               width:"300px",
                               position:"right",
                               background: "#28a745",
                               color: "#fff",
                           },
                           onClick: function () {},
                       }).showToast();
             }
             else { 
                if(response.status = 400){
                    Toastify({
                        text: response.message,
                        duration: 3000,
                               gravity: "top",
                               position: "right",
                               stopOnFocus: true,
                               style: {
                                   width:"300px",
                                   position:"right",
                                   background: "#28a745",
                                   color: "red",
                               },
                               onClick: function () {},
                           }).showToast();
                }
                else{
                    Toastify({
                        text: "Something Went Wrong...!!!",
                        duration: 3000,
                               gravity: "top",
                               position: "right",
                               stopOnFocus: true,
                               style: {
                                   width:"300px",
                                   position:"right",
                                   background: "#28a745",
                                   color: "#fff",
                               },
                               onClick: function () {},
                           }).showToast();
                        
                }

             }
                
            },
            error: function (xhr, status, error) {
                console.log(xhr.responseJSON.errors
                );
                if(xhr.status = 400){
                    Toastify({
                        text: xhr.responseJSON.errors,
                        duration: 3000,
                               gravity: "top",
                               position: "right",
                               stopOnFocus: true,
                               style: {
                                   width:"300px",
                                   position:"right",
                                   background: "red",
                                   color: "#fff",
                               },
                               onClick: function () {},
                           }).showToast();
                }
                else{
                    Toastify({
                        text: "Something Went Wrong...!!!",
                        duration: 3000,
                               gravity: "top",
                               position: "right",
                               stopOnFocus: true,
                               style: {
                                   width:"300px",
                                   position:"right",
                                   background: "#28a745",
                                   color: "#fff",
                               },
                               onClick: function () {},
                           }).showToast();
                        
                }
            },
          });
        });
      });
    
      function loadTableData () {
        var accessToken = localStorage.getItem('access_token');
        var refreshToken = localStorage.getItem('refresh_token');
        var count = 0
          $.ajax({
            url: `http://127.0.0.1:8000/leave/approve/update/${count}`,
            
            type: "GET",
            
            success: function (response) {
            console.log(response)
                $("#genrater").html(response);

                count++;
    
            },
            error: function (xhr, status, error) {
              console.error(error);
            },
          });
        }
    
      {% comment %} // delete leave
    
      $(document).on('click', '.delete', function (e) {
        var id = $(this).attr("id");
        console.log(id);
        var url = `http://127.0.0.1:8000/leave/delete/user-leave/${id}`
        var accessToken = localStorage.getItem('access_token');
        var refreshToken = localStorage.getItem('refresh_token');
        $.ajax({
            url: url,
            type: "DELETE",
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Authorization': `Bearer ${refreshToken}`,
                'refresh_token': refreshToken
             },
            success: function (response) {
                    Toastify({
                     text: response.message,
                     duration: 3000,
                            gravity: "top",
                            position: "right",
                            stopOnFocus: true,
                            style: {
                                width:"300px",
                                position:"right",
                                background: "#28a745",
                                color: "#fff",
                            },
                            onClick: function () {},
                        }).showToast();
                if (response.status=="success"){
                    loadTableData();
                }
            },
            error: function (xhr, status, error) {
                    console.error(error);
                    },
             });
    }); {% endcomment %}
</script>
</body>
</html>

</body>
</html>
